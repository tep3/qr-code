<div class="text-center mb-12 animate-fade-up">
  <div
    class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-primary/10 text-primary text-xs font-semibold tracking-wide mb-5"
    data-i18n="home_badge"
  >
    Free Â· No signup Â· Works offline
  </div>
  <h1 class="text-4xl sm:text-5xl font-serif mb-3 tracking-tight">
    <span data-i18n="home_title_pre">Craft your</span>
    <span class="text-primary" data-i18n="home_title_post">QR Code</span>
  </h1>
  <p
    class="text-base-content/50 text-base sm:text-lg max-w-md mx-auto leading-relaxed"
    data-i18n="home_desc"
  >
    Generate beautiful QR codes for links, WiFi, contacts and more â€” in seconds.
  </p>
</div>

<div class="grid grid-cols-1 lg:grid-cols-5 gap-8 lg:gap-10 items-start">
  <div class="lg:col-span-3 space-y-5">
    <div class="animate-fade-up delay-1">
      <label
        class="block text-[11px] uppercase tracking-widest text-base-content/40 mb-2.5 font-semibold pl-1"
        data-i18n="label_encode"
      >
        What do you want to encode?
      </label>
      <div id="type-tabs" class="flex flex-wrap gap-2" role="tablist">
        <!-- PromptPay Tab (New) -->
        <button
          class="tab-btn flex flex-col items-center gap-1 py-2.5 px-3 rounded-xl border-2 border-primary bg-primary/5 transition-all duration-200 min-w-[60px]"
          data-type="promptpay"
          onclick="loadPromptPayForm(this)"
        >
          <span class="text-lg leading-none">ğŸ‡¹ğŸ‡­</span>
          <span class="text-[11px] font-semibold text-primary">PromptPay</span>
        </button>

        <button
          hx-get="/partials/qr-form/url"
          hx-target="#form-fields"
          hx-swap="innerHTML transition:true"
          class="tab-btn flex flex-col items-center gap-1 py-2.5 px-3 rounded-xl border-2 border-base-200 hover:border-base-300 bg-base-100 transition-all duration-200 min-w-[60px]"
          data-type="url"
          onclick="switchTab(this)"
        >
          <span class="text-lg leading-none">ğŸ”—</span>
          <span
            class="text-[11px] font-medium text-base-content/50"
            data-i18n="tab_url"
            >URL</span
          >
        </button>

        <button
          hx-get="/partials/qr-form/text"
          hx-target="#form-fields"
          hx-swap="innerHTML transition:true"
          class="tab-btn flex flex-col items-center gap-1 py-2.5 px-3 rounded-xl border-2 border-base-200 hover:border-base-300 bg-base-100 transition-all duration-200 min-w-[60px]"
          data-type="text"
          onclick="switchTab(this)"
        >
          <span class="text-lg leading-none">ğŸ“</span>
          <span
            class="text-[11px] font-medium text-base-content/50"
            data-i18n="tab_text"
            >Text</span
          >
        </button>

        <button
          hx-get="/partials/qr-form/wifi"
          hx-target="#form-fields"
          hx-swap="innerHTML transition:true"
          class="tab-btn flex flex-col items-center gap-1 py-2.5 px-3 rounded-xl border-2 border-base-200 hover:border-base-300 bg-base-100 transition-all duration-200 min-w-[60px]"
          data-type="wifi"
          onclick="switchTab(this)"
        >
          <span class="text-lg leading-none">ğŸ“¶</span>
          <span
            class="text-[11px] font-medium text-base-content/50"
            data-i18n="tab_wifi"
            >WiFi</span
          >
        </button>

        <button
          hx-get="/partials/qr-form/vcard"
          hx-target="#form-fields"
          hx-swap="innerHTML transition:true"
          class="tab-btn flex flex-col items-center gap-1 py-2.5 px-3 rounded-xl border-2 border-base-200 hover:border-base-300 bg-base-100 transition-all duration-200 min-w-[60px]"
          data-type="vcard"
          onclick="switchTab(this)"
        >
          <span class="text-lg leading-none">ğŸ‘¤</span>
          <span
            class="text-[11px] font-medium text-base-content/50"
            data-i18n="tab_vcard"
            >vCard</span
          >
        </button>

        <button
          hx-get="/partials/qr-form/email"
          hx-target="#form-fields"
          hx-swap="innerHTML transition:true"
          class="tab-btn flex flex-col items-center gap-1 py-2.5 px-3 rounded-xl border-2 border-base-200 hover:border-base-300 bg-base-100 transition-all duration-200 min-w-[60px]"
          data-type="email"
          onclick="switchTab(this)"
        >
          <span class="text-lg leading-none">âœ‰ï¸</span>
          <span
            class="text-[11px] font-medium text-base-content/50"
            data-i18n="tab_email"
            >Email</span
          >
        </button>

        <button
          hx-get="/partials/qr-form/phone"
          hx-target="#form-fields"
          hx-swap="innerHTML transition:true"
          class="tab-btn flex flex-col items-center gap-1 py-2.5 px-3 rounded-xl border-2 border-base-200 hover:border-base-300 bg-base-100 transition-all duration-200 min-w-[60px]"
          data-type="phone"
          onclick="switchTab(this)"
        >
          <span class="text-lg leading-none">ğŸ“</span>
          <span
            class="text-[11px] font-medium text-base-content/50"
            data-i18n="tab_phone"
            >Phone</span
          >
        </button>

        <button
          hx-get="/partials/qr-form/sms"
          hx-target="#form-fields"
          hx-swap="innerHTML transition:true"
          class="tab-btn flex flex-col items-center gap-1 py-2.5 px-3 rounded-xl border-2 border-base-200 hover:border-base-300 bg-base-100 transition-all duration-200 min-w-[60px]"
          data-type="sms"
          onclick="switchTab(this)"
        >
          <span class="text-lg leading-none">ğŸ’¬</span>
          <span
            class="text-[11px] font-medium text-base-content/50"
            data-i18n="tab_sms"
            >SMS</span
          >
        </button>

        <button
          hx-get="/partials/qr-form/line"
          hx-target="#form-fields"
          hx-swap="innerHTML transition:true"
          class="tab-btn flex flex-col items-center gap-1 py-2.5 px-3 rounded-xl border-2 border-base-200 hover:border-base-300 bg-base-100 transition-all duration-200 min-w-[60px]"
          data-type="line"
          onclick="switchTab(this)"
        >
          <span class="text-lg leading-none">ğŸ’š</span>
          <span
            class="text-[11px] font-medium text-base-content/50"
            data-i18n="tab_line"
            >LINE</span
          >
        </button>

        <button
          hx-get="/partials/qr-form/facebook"
          hx-target="#form-fields"
          hx-swap="innerHTML transition:true"
          class="tab-btn flex flex-col items-center gap-1 py-2.5 px-3 rounded-xl border-2 border-base-200 hover:border-base-300 bg-base-100 transition-all duration-200 min-w-[60px]"
          data-type="facebook"
          onclick="switchTab(this)"
        >
          <span class="text-lg leading-none">ğŸ“˜</span>
          <span
            class="text-[11px] font-medium text-base-content/50"
            data-i18n="tab_facebook"
            >Facebook</span
          >
        </button>
      </div>
    </div>

    <form
      id="qr-form"
      hx-post="/api/qr/generate"
      hx-target="#qr-preview"
      hx-swap="innerHTML transition:true"
      hx-indicator="#loading-spinner"
      class="space-y-5"
    >
      <input type="hidden" name="type" id="qr-type" value="promptpay" />
      <div
        class="animate-fade-up delay-2 bg-base-100 rounded-2xl border border-base-200 p-5 shadow-sm"
      >
        <label
          class="block text-[11px] uppercase tracking-widest text-base-content/40 mb-3 font-semibold"
          data-i18n="label_content"
          >Content</label
        >
        <div id="form-fields">
          <div class="space-y-4">
            <div class="form-control">
              <label class="label pb-1">
                <span class="label-text font-medium">
                  <span class="text-lg mr-1">ğŸ†”</span> PromptPay ID
                </span>
              </label>
              <input
                type="text"
                name="content.promptpayId"
                placeholder="08X-XXX-XXXX or Tax ID"
                class="input input-bordered w-full bg-base-200/50 border-base-200 focus:border-primary font-mono"
                required
                data-i18n="ph_promptpay_id"
              />
              <label class="label pt-1">
                <span
                  class="label-text-alt text-base-content/40"
                  data-i18n="help_promptpay_id"
                  >Mobile number or Tax ID / E-Wallet ID</span
                >
              </label>
            </div>

            <div class="form-control">
              <label class="label pb-1">
                <span class="label-text font-medium">
                  <span class="text-lg mr-1">ğŸ’°</span> Amount (Optional)
                </span>
              </label>
              <input
                type="number"
                name="content.amount"
                placeholder="0.00"
                step="0.01"
                min="0"
                class="input input-bordered w-full bg-base-200/50 border-base-200 focus:border-primary font-mono"
              />
            </div>
          </div>
        </div>
      </div>

      <details
        class="animate-fade-up delay-3 group bg-base-100 rounded-2xl border border-base-200 shadow-sm overflow-hidden"
      >
        <summary
          class="flex items-center justify-between cursor-pointer p-5 select-none hover:bg-base-200/30 transition-colors"
        >
          <div class="flex items-center gap-3">
            <div
              class="w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center"
            >
              <svg
                class="w-4 h-4 text-primary"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M9.53 16.122a3 3 0 00-5.78 1.128 2.25 2.25 0 01-2.4 2.245 4.5 4.5 0 008.4-2.245c0-.399-.078-.78-.22-1.128zm0 0a15.998 15.998 0 003.388-1.62m-5.043-.025a15.994 15.994 0 011.622-3.395m3.42 3.42a15.995 15.995 0 004.764-4.648l3.876-5.814a1.151 1.151 0 00-1.597-1.597L14.146 6.32a15.996 15.996 0 00-4.649 4.763m3.42 3.42a6.776 6.776 0 00-3.42-3.42"
                />
              </svg>
            </div>
            <div>
              <span class="text-sm font-semibold" data-i18n="summary_style"
                >Customize Style</span
              >
              <span
                class="block text-[11px] text-base-content/40"
                data-i18n="summary_style_desc"
                >Colors, size, label, logo & more</span
              >
            </div>
          </div>
          <svg
            class="w-5 h-5 text-base-content/30 transition-transform duration-300 group-open:rotate-180"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M19.5 8.25l-7.5 7.5-7.5-7.5"
            />
          </svg>
        </summary>

        <div class="px-5 pb-5 pt-2 border-t border-base-200">
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-5 mt-3">
            <div class="form-control">
              <label class="label pb-1"
                ><span
                  class="label-text font-medium text-sm"
                  data-i18n="style_fg"
                  >Foreground</span
                ></label
              >
              <div class="flex items-center gap-3">
                <input
                  type="color"
                  name="style.fgColor"
                  value="#000000"
                  id="fg-color"
                  class="w-10 h-10 rounded-lg cursor-pointer border border-base-200 bg-transparent p-0.5"
                />
                <input
                  type="text"
                  value="#000000"
                  id="fg-color-text"
                  class="input input-bordered input-sm w-28 bg-base-200/50 border-base-200 font-mono text-xs"
                  pattern="^#[0-9a-fA-F]{6}$"
                  onchange="
                    document.getElementById('fg-color').value = this.value
                  "
                />
              </div>
            </div>
            <div class="form-control">
              <label class="label pb-1"
                ><span
                  class="label-text font-medium text-sm"
                  data-i18n="style_bg"
                  >Background</span
                ></label
              >
              <div class="flex items-center gap-3">
                <input
                  type="color"
                  name="style.bgColor"
                  value="#ffffff"
                  id="bg-color"
                  class="w-10 h-10 rounded-lg cursor-pointer border border-base-200 bg-transparent p-0.5"
                />
                <input
                  type="text"
                  value="#ffffff"
                  id="bg-color-text"
                  class="input input-bordered input-sm w-28 bg-base-200/50 border-base-200 font-mono text-xs"
                  pattern="^#[0-9a-fA-F]{6}$"
                  onchange="
                    document.getElementById('bg-color').value = this.value
                  "
                />
              </div>
            </div>
            <div class="form-control">
              <label class="label pb-1"
                ><span
                  class="label-text font-medium text-sm"
                  data-i18n="style_dot"
                  >Dot Style</span
                ></label
              >
              <select
                name="style.dotStyle"
                class="select select-bordered select-sm w-full bg-base-200/50 border-base-200"
              >
                <option value="square" selected>â–  Square</option>
                <option value="rounded">Rounded</option>
                <option value="dots">â—‰ Dots</option>
              </select>
            </div>
            <div class="form-control">
              <label class="label pb-1"
                ><span
                  class="label-text font-medium text-sm"
                  data-i18n="style_ec"
                  >Error Correction</span
                ></label
              >
              <select
                name="style.ecLevel"
                class="select select-bordered select-sm w-full bg-base-200/50 border-base-200"
              >
                <option value="L">Low (7%)</option>
                <option value="M" selected>Medium (15%)</option>
                <option value="Q">Quartile (25%)</option>
                <option value="H">High (30%)</option>
              </select>
            </div>
            <div class="form-control">
              <label class="label pb-1"
                ><span
                  class="label-text font-medium text-sm"
                  data-i18n="style_size"
                  >Size</span
                ></label
              >
              <select
                name="style.width"
                class="select select-bordered select-sm w-full bg-base-200/50 border-base-200"
              >
                <option value="256">256 Ã— 256</option>
                <option value="512" selected>512 Ã— 512</option>
                <option value="1024">1024 Ã— 1024</option>
                <option value="2048">2048 Ã— 2048</option>
              </select>
            </div>
            <div class="form-control">
              <label class="label pb-1"
                ><span
                  class="label-text font-medium text-sm"
                  data-i18n="style_margin"
                  >Margin</span
                ></label
              >
              <input
                type="range"
                name="style.margin"
                min="0"
                max="8"
                value="2"
                class="range range-xs range-primary mt-2"
                id="margin-range"
                oninput="
                  document.getElementById('margin-value').textContent =
                    this.value
                "
              />
              <label class="label pt-0.5">
                <span class="label-text-alt text-base-content/40"
                  ><span data-i18n="style_quiet_zone">Quiet zone:</span>
                  <span id="margin-value">2</span>
                  <span data-i18n="style_modules">modules</span></span
                >
              </label>
            </div>
          </div>

          <div class="mt-6 pt-4 border-t border-base-200">
            <label class="label pb-2"
              ><span
                class="label-text font-bold text-sm"
                data-i18n="label_text_opt"
                >Label Text (Optional)</span
              ></label
            >
            <div
              class="grid grid-cols-1 sm:grid-cols-2 gap-4 bg-base-200/30 p-4 rounded-xl"
            >
              <div class="form-control sm:col-span-2">
                <input
                  type="text"
                  name="style.labelText"
                  placeholder="Enter text (e.g. SCAN ME)"
                  class="input input-bordered input-sm w-full focus:border-primary"
                  maxlength="25"
                />
              </div>

              <div class="form-control">
                <label class="label pb-0"
                  ><span
                    class="label-text-alt font-medium"
                    data-i18n="label_size"
                    >Size</span
                  ></label
                >
                <input
                  type="range"
                  name="style.labelSize"
                  min="4"
                  max="15"
                  value="7"
                  class="range range-xs range-primary mt-2"
                />
                <div
                  class="flex justify-between text-[10px] text-base-content/40 px-1 mt-1"
                >
                  <span>Small</span><span>Large</span>
                </div>
              </div>

              <div class="form-control">
                <label class="label pb-0"
                  ><span
                    class="label-text-alt font-medium"
                    data-i18n="label_pos"
                    >Position</span
                  ></label
                >
                <div class="flex gap-4 mt-2">
                  <label class="flex items-center gap-2 cursor-pointer">
                    <input
                      type="radio"
                      name="style.labelPosition"
                      value="bottom"
                      class="radio radio-xs radio-primary"
                      checked
                    />
                    <span class="text-xs" data-i18n="label_pos_bottom"
                      >Bottom</span
                    >
                  </label>
                  <label class="flex items-center gap-2 cursor-pointer">
                    <input
                      type="radio"
                      name="style.labelPosition"
                      value="top"
                      class="radio radio-xs radio-primary"
                    />
                    <span class="text-xs" data-i18n="label_pos_top">Top</span>
                  </label>
                </div>
              </div>

              <div class="form-control sm:col-span-2">
                <label class="label pb-1"
                  ><span
                    class="label-text-alt font-medium"
                    data-i18n="label_color"
                    >Text Color</span
                  ></label
                >
                <div class="flex items-center gap-3">
                  <input
                    type="color"
                    name="style.labelColor"
                    value="#000000"
                    id="lbl-color"
                    class="w-8 h-8 rounded cursor-pointer border border-base-200 p-0.5"
                  />
                  <input
                    type="text"
                    value="#000000"
                    id="lbl-color-text"
                    class="input input-bordered input-sm w-28 bg-base-100 border-base-200 font-mono text-xs"
                    pattern="^#[0-9a-fA-F]{6}$"
                    onchange="
                      document.getElementById('lbl-color').value = this.value
                    "
                  />
                  <span
                    class="text-[10px] text-base-content/40"
                    data-i18n="label_color_help"
                    >Matches QR color by default</span
                  >
                </div>
              </div>
            </div>
          </div>

          <!-- Border / Frame -->
          <div class="mt-6 pt-4 border-t border-base-200">
            <label class="label pb-1"
              ><span
                class="label-text font-bold text-sm"
                data-i18n="border_frame"
                >Border / Frame</span
              ></label
            >
            <div
              id="border-picker"
              class="grid grid-cols-3 sm:grid-cols-5 gap-2 mt-1"
            >
              <!-- None -->
              <label class="cursor-pointer border-option">
                <input
                  type="radio"
                  name="style.borderStyle"
                  value="none"
                  class="hidden"
                  checked
                />
                <div class="border-preview-box selected">
                  <div class="bp-qr"></div>
                  <span class="bp-label">None</span>
                </div>
              </label>

              <!-- Rounded Frames -->
              <label class="cursor-pointer border-option">
                <input
                  type="radio"
                  name="style.borderStyle"
                  value="round-sm"
                  class="hidden"
                />
                <div class="border-preview-box">
                  <div class="bp-demo bp-round-sm">
                    <div class="bp-qr"></div>
                  </div>
                  <span class="bp-label">Rounded</span>
                </div>
              </label>

              <label class="cursor-pointer border-option">
                <input
                  type="radio"
                  name="style.borderStyle"
                  value="round-lg"
                  class="hidden"
                />
                <div class="border-preview-box">
                  <div class="bp-demo bp-round-lg">
                    <div class="bp-qr"></div>
                  </div>
                  <span class="bp-label">Pill</span>
                </div>
              </label>

              <label class="cursor-pointer border-option">
                <input
                  type="radio"
                  name="style.borderStyle"
                  value="circle"
                  class="hidden"
                />
                <div class="border-preview-box">
                  <div class="bp-demo bp-circle"><div class="bp-qr"></div></div>
                  <span class="bp-label">Circle</span>
                </div>
              </label>

              <label class="cursor-pointer border-option">
                <input
                  type="radio"
                  name="style.borderStyle"
                  value="glow"
                  class="hidden"
                />
                <div class="border-preview-box">
                  <div class="bp-demo bp-glow"><div class="bp-qr"></div></div>
                  <span class="bp-label">Glow</span>
                </div>
              </label>

              <!-- Decorative -->
              <label class="cursor-pointer border-option">
                <input
                  type="radio"
                  name="style.borderStyle"
                  value="corners"
                  class="hidden"
                />
                <div class="border-preview-box">
                  <div class="bp-demo bp-corners">
                    <div class="bp-qr"></div>
                  </div>
                  <span class="bp-label">Corners</span>
                </div>
              </label>

              <label class="cursor-pointer border-option">
                <input
                  type="radio"
                  name="style.borderStyle"
                  value="gradient"
                  class="hidden"
                />
                <div class="border-preview-box">
                  <div class="bp-demo bp-gradient">
                    <div class="bp-qr"></div>
                  </div>
                  <span class="bp-label">Gradient</span>
                </div>
              </label>

              <label class="cursor-pointer border-option">
                <input
                  type="radio"
                  name="style.borderStyle"
                  value="scan-me"
                  class="hidden"
                />
                <div class="border-preview-box">
                  <div class="bp-demo bp-scanme">
                    <div class="bp-qr"></div>
                    <span class="bp-scanme-text">SCAN ME</span>
                  </div>
                  <span class="bp-label">Scan Me</span>
                </div>
              </label>

              <label class="cursor-pointer border-option">
                <input
                  type="radio"
                  name="style.borderStyle"
                  value="ticker"
                  class="hidden"
                />
                <div class="border-preview-box">
                  <div class="bp-demo bp-ticker">
                    <span class="bp-ticker-text">&#9670; QR FORGE &#9670;</span>
                    <div class="bp-qr"></div>
                  </div>
                  <span class="bp-label">Ticker</span>
                </div>
              </label>
            </div>

            <!-- Border Color -->
            <div class="flex items-center gap-3 mt-3" id="border-color-row">
              <label class="label-text-alt font-medium" data-i18n="border_color"
                >Border Color</label
              >
              <input
                type="color"
                name="style.borderColor"
                value="#000000"
                id="border-color"
                class="w-8 h-8 rounded cursor-pointer border border-base-200 p-0.5"
              />
              <input
                type="text"
                value="#000000"
                id="border-color-text"
                class="input input-bordered input-sm w-28 bg-base-200/50 border-base-200 font-mono text-xs"
                pattern="^#[0-9a-fA-F]{6}$"
                onchange="
                  document.getElementById('border-color').value = this.value
                "
              />
              <span
                class="text-[10px] text-base-content/40"
                data-i18n="label_color_help"
                >Matches QR color by default</span
              >
            </div>
          </div>
        </div>
      </details>

      <div class="animate-fade-up delay-4">
        <button
          type="submit"
          class="btn btn-primary w-full text-base gap-2.5 h-13 rounded-xl shadow-md hover:shadow-lg transition-shadow font-semibold"
        >
          <span
            id="loading-spinner"
            class="loading loading-spinner loading-sm htmx-indicator"
          ></span>
          <svg
            class="w-5 h-5"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z"
            />
          </svg>
          <span data-i18n="btn_generate">Generate QR Code</span>
        </button>
      </div>
    </form>
  </div>

  <div class="lg:col-span-2">
    <div class="lg:sticky lg:top-24 space-y-4">
      <div
        class="animate-fade-up delay-2 bg-base-100 rounded-2xl border border-base-200 p-6 shadow-sm"
      >
        <label
          class="block text-[11px] uppercase tracking-widest text-base-content/40 mb-4 font-semibold"
          data-i18n="preview_title"
          >Preview</label
        >
        <div id="qr-preview">
          <!-- Preview Content -->
          <div
            class="flex flex-col items-center justify-center py-10 text-center"
          >
            <div
              class="relative w-44 h-44 rounded-2xl bg-base-200/50 flex items-center justify-center mb-5 text-base-content/20"
            >
              <svg class="w-16 h-16" fill="currentColor" viewBox="0 0 24 24">
                <path
                  d="M3 3h6v6H3V3zm2 2v2h2V5H5zm8-2h6v6h-6V3zm2 2v2h2V5h-2zM3 15h6v6H3v-6zm2 2v2h2v-2H5zm8 4h2v2h-2v-2zm-2-2h2v2h-2v-2zm2-2h2v2h-2v-2zm2 2h2v2h-2v-2z"
                ></path>
              </svg>
            </div>
            <p
              class="text-base-content/40 text-sm font-medium"
              data-i18n="preview_placeholder"
            >
              Your QR code will appear here
            </p>
            <p
              class="text-base-content/25 text-xs mt-1"
              data-i18n="preview_help"
            >
              Fill in the content and hit Generate
            </p>
          </div>
        </div>

        <!-- Action Buttons (Show after generate) -->
        <div id="qr-actions" class="hidden mt-4 grid grid-cols-2 gap-2">
          <button
            onclick="downloadQR('png')"
            class="btn btn-outline btn-sm rounded-lg"
          >
            <svg
              class="w-4 h-4 mr-1"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
              />
            </svg>
            PNG
          </button>
          <button
            onclick="downloadQR('svg')"
            class="btn btn-outline btn-sm rounded-lg"
          >
            <svg
              class="w-4 h-4 mr-1"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
              />
            </svg>
            SVG
          </button>
          <button
            id="save-to-history-btn"
            onclick="saveToHistory()"
            class="btn btn-ghost btn-sm rounded-lg col-span-2 text-base-content/50"
          >
            <svg
              class="w-4 h-4 mr-1"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"
              />
            </svg>
            <span data-i18n="btn_save_history">Save to History</span>
          </button>
        </div>
      </div>

      <div class="animate-fade-up delay-3 grid grid-cols-3 gap-2">
        <div
          class="bg-base-100 rounded-xl border border-base-200 p-3 text-center"
        >
          <div class="text-base mb-1">ğŸ”’</div>
          <div
            class="text-[10px] font-semibold text-base-content/50 leading-tight"
            data-i18n="badge_private"
          >
            Private
          </div>
        </div>
        <div
          class="bg-base-100 rounded-xl border border-base-200 p-3 text-center"
        >
          <div class="text-base mb-1">âš¡</div>
          <div
            class="text-[10px] font-semibold text-base-content/50 leading-tight"
            data-i18n="badge_instant"
          >
            Instant
          </div>
        </div>
        <div
          class="bg-base-100 rounded-xl border border-base-200 p-3 text-center"
        >
          <div class="text-base mb-1">ğŸ</div>
          <div
            class="text-[10px] font-semibold text-base-content/50 leading-tight"
            data-i18n="badge_free"
          >
            100% Free
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Template for PromptPay Form (Injected via JS) -->
<template id="promptpay-template">
  <div class="space-y-4">
    <div class="form-control">
      <label class="label pb-1">
        <span class="label-text font-medium">
          <span class="text-lg mr-1">ğŸ†”</span> PromptPay ID
        </span>
      </label>
      <input
        type="text"
        name="content.promptpayId"
        placeholder="08X-XXX-XXXX or Tax ID"
        class="input input-bordered w-full bg-base-200/50 border-base-200 focus:border-primary font-mono"
        required
        data-i18n="ph_promptpay_id"
      />
      <label class="label pt-1">
        <span
          class="label-text-alt text-base-content/40"
          data-i18n="help_promptpay_id"
          >Mobile number or Tax ID / E-Wallet ID</span
        >
      </label>
    </div>

    <div class="form-control">
      <label class="label pb-1">
        <span class="label-text font-medium">
          <span class="text-lg mr-1">ğŸ’°</span> Amount (Optional)
        </span>
      </label>
      <input
        type="number"
        name="content.amount"
        placeholder="0.00"
        step="0.01"
        min="0"
        class="input input-bordered w-full bg-base-200/50 border-base-200 focus:border-primary font-mono"
      />
    </div>
  </div>
</template>

<script>
  /** Tab switching */
  function switchTab(clickedBtn) {
    document.querySelectorAll(".tab-btn").forEach(function (btn) {
      btn.classList.remove("border-primary", "bg-primary/5");
      btn.classList.add("border-base-200", "bg-base-100");
      var label = btn.querySelector("span:last-child");
      if (label) {
        label.classList.remove("text-primary", "font-semibold");
        label.classList.add("text-base-content/50", "font-medium");
      }
    });
    clickedBtn.classList.remove("border-base-200", "bg-base-100");
    clickedBtn.classList.add("border-primary", "bg-primary/5");
    var activeLabel = clickedBtn.querySelector("span:last-child");
    if (activeLabel) {
      activeLabel.classList.remove("text-base-content/50", "font-medium");
      activeLabel.classList.add("text-primary", "font-semibold");
    }
    document.getElementById("qr-type").value = clickedBtn.dataset.type;

    // Reset preview when switching tabs
    document.getElementById("qr-actions")?.classList.add("hidden");
  }

  // Handle PromptPay Tab separately (Client-Side Rendering)
  function loadPromptPayForm(btn) {
    switchTab(btn);
    var template = document.getElementById("promptpay-template");
    var container = document.getElementById("form-fields");
    container.innerHTML = "";
    container.appendChild(template.content.cloneNode(true));

    // Trigger i18n update for the new content if the function exists
    if (window.updatePageContent) window.updatePageContent();
  }

  // â”€â”€â”€ Color Picker Sync â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Keep <input type="color"> and its text input in sync both ways

  function syncColorPair(colorId, textId) {
    var colorInput = document.getElementById(colorId);
    var textInput = document.getElementById(textId);
    if (!colorInput || !textInput) return;

    colorInput.addEventListener("input", function () {
      textInput.value = colorInput.value;
    });
    textInput.addEventListener("change", function () {
      if (/^#[0-9a-fA-F]{6}$/.test(textInput.value)) {
        colorInput.value = textInput.value;
      }
    });
  }

  syncColorPair("fg-color", "fg-color-text");
  syncColorPair("bg-color", "bg-color-text");
  syncColorPair("lbl-color", "lbl-color-text");
  syncColorPair("border-color", "border-color-text");

  // â”€â”€â”€ Border / Frame Picker â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Highlight the selected border option visually

  document
    .querySelectorAll("#border-picker .border-option input[type=radio]")
    .forEach(function (radio) {
      radio.addEventListener("change", function () {
        // Remove 'selected' from all preview boxes
        document
          .querySelectorAll("#border-picker .border-preview-box")
          .forEach(function (box) {
            box.classList.remove("selected");
          });
        // Add 'selected' to the parent preview box of the checked radio
        var box = radio
          .closest(".border-option")
          .querySelector(".border-preview-box");
        if (box) box.classList.add("selected");
      });
    });

  // â”€â”€â”€ Show QR Actions after successful generation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.addEventListener("htmx:afterSwap", function (evt) {
    if (evt.detail.target.id === "qr-preview") {
      // Check if we got a valid QR image
      var preview = document.getElementById("qr-preview");
      var hasImage = preview?.querySelector("img") !== null;

      if (hasImage) {
        document.getElementById("qr-actions")?.classList.remove("hidden");
        window.showToast("QR Code generated successfully!", "success", 2000);
      }
    }
  });

  // â”€â”€â”€ Form validation before submit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById("qr-form")?.addEventListener("submit", function (e) {
    var type = document.getElementById("qr-type").value;
    var hasContent = false;

    // Check if any content field has value
    var contentInputs = this.querySelectorAll('input[name^="content."]');
    contentInputs.forEach(function (input) {
      if (input.value.trim()) hasContent = true;
    });

    if (!hasContent) {
      e.preventDefault();
      window.showToast("Please fill in the content fields", "warning");
      return false;
    }
  });
</script>
